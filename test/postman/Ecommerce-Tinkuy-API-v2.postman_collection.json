{
  "info": {
    "name": "Ecommerce-Tinkuy API v2",
    "_postman_id": "7a6d7f9e-1e2a-4a21-9caa-1b2c3d4e5f6a",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "description": "Colección organizada por módulos para Pruebas de Integración (IX). IA completa; se agregan endpoints reales de Auth, Productos, Carrito, Pago y Vendedor/Envíos. Usa el environment {{baseUrl}}."
  },
  "item": [
    {
      "name": "IA",
      "item": [
        {
          "name": "POST válido (200)",
          "request": {
            "method": "POST",
            "header": [ { "key": "Content-Type", "value": "application/json" } ],
            "url": "{{basePublic}}/deepseek_search.php",
            "body": { "mode": "raw", "raw": "{\n  \"query\": \"chompa de alpaca\"\n}" }
          },
          "event": [ { "listen": "test", "script": { "exec": [
            "pm.test('Status 200',()=>pm.response.to.have.status(200));",
            "const json=pm.response.json();",
            "pm.test('Tiene texto',()=>pm.expect(json.texto).to.be.a('string').and.not.empty);"
          ] } } ]
        },
        {
          "name": "POST query vacío (400)",
          "request": {
            "method": "POST",
            "header": [ { "key": "Content-Type", "value": "application/json" } ],
            "url": "{{basePublic}}/deepseek_search.php",
            "body": { "mode": "raw", "raw": "{\n  \"query\": \"\"\n}" }
          },
          "event": [ { "listen": "test", "script": { "exec": [
            "pm.test('Status 400',()=>pm.response.to.have.status(400));",
            "const json=pm.response.json();",
            "pm.test('Mensaje de validación',()=>pm.expect(json.error).to.include('Query vacío'));"
          ] } } ]
        },
        {
          "name": "GET no permitido (405)",
          "request": { "method": "GET", "url": "{{basePublic}}/deepseek_search.php" },
          "event": [ { "listen": "test", "script": { "exec": [
            "pm.test('Status 405',()=>pm.response.to.have.status(405));"
          ] } } ]
        },
        {
          "name": "Modo demo (200)",
          "request": {
            "method": "POST",
            "header": [ { "key": "Content-Type", "value": "application/json" } ],
            "url": "{{basePublic}}/deepseek_search.php?demo=1",
            "body": { "mode": "raw", "raw": "{\n  \"query\": \"Quiero un regalo para mi mamá\"\n}" }
          },
          "event": [ { "listen": "test", "script": { "exec": [
            "pm.test('Status 200',()=>pm.response.to.have.status(200));",
            "const json=pm.response.json();",
            "pm.test('Demo tiene texto',()=>pm.expect(json.texto).to.be.a('string').and.not.empty);"
          ] } } ]
        }
      ]
    },
    {
      "name": "Debug/Health",
      "item": [
        {
          "name": "IA Debug (?debug=1)",
          "request": { "method": "GET", "url": "{{basePublic}}/deepseek_search.php?debug=1" },
          "event": [ { "listen": "test", "script": { "exec": [
            "pm.test('Status 200',()=>pm.response.to.have.status(200));",
            "const json=pm.response.json();",
            "pm.test('Tiene claves de diagnostico',()=>pm.expect(json).to.have.keys(['root','env_local_path','env_path','env_local_readable','env_readable','has_env_var','env_local_has_key','env_has_key','demo_env_set','note']));"
          ] } } ]
        }
      ]
    },
    {
      "name": "Auth",
      "item": [
        {
          "name": "POST login (form)",
          "request": {
            "method": "POST",
            "header": [ { "key": "Content-Type", "value": "application/x-www-form-urlencoded" } ],
            "url": "{{baseUrl}}/index.php?page=login",
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                { "key": "usuario", "value": "admin", "type": "text" },
                { "key": "clave", "value": "admin123", "type": "text" }
              ]
            }
          },
          "description": "Procesa login vía vista login.php + AuthController. Puede redirigir (302)."
        },
        {
          "name": "POST register (form)",
          "request": {
            "method": "POST",
            "header": [ { "key": "Content-Type", "value": "application/x-www-form-urlencoded" } ],
            "url": "{{baseUrl}}/index.php?page=register",
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                { "key": "usuario", "value": "cliente_demo", "type": "text" },
                { "key": "email", "value": "cliente.demo@example.com", "type": "text" },
                { "key": "clave", "value": "ClaveDemo!1", "type": "text" },
                { "key": "clave_repetida", "value": "ClaveDemo!1", "type": "text" },
                { "key": "nombres", "value": "Cliente", "type": "text" },
                { "key": "apellidos", "value": "Demo", "type": "text" },
                { "key": "telefono", "value": "", "type": "text" }
              ]
            }
          },
          "description": "Registra usuario (rol cliente). Puede iniciar sesión automáticamente."
        }
      ]
    },
    {
      "name": "Productos",
      "item": [
        {
          "name": "GET productos (filtros)",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/index.php?page=products&buscar={{buscar}}&categoria={{categoria}}&orden={{orden}}"
          },
          "variable": [
            { "key": "buscar", "value": "chompa" },
            { "key": "categoria", "value": "" },
            { "key": "orden", "value": "nombre_asc" }
          ]
        },
        {
          "name": "GET producto (detalle)",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/index.php?page=producto&id={{id_producto}}"
          },
          "variable": [ { "key": "id_producto", "value": "1" } ]
        }
      ]
    },
    {
      "name": "Carrito",
      "item": [
        {
          "name": "POST agregar_carrito",
          "request": {
            "method": "POST",
            "header": [ { "key": "Content-Type", "value": "application/x-www-form-urlencoded" } ],
            "url": "{{baseUrl}}/index.php?page=agregar_carrito",
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                { "key": "id_variante", "value": "1", "type": "text" },
                { "key": "cantidad", "value": "1", "type": "text" }
              ]
            }
          },
          "description": "Agrega variante al carrito (usa sesión). Redirige a cart."
        },
        {
          "name": "GET cart (vista)",
          "request": { "method": "GET", "url": "{{baseUrl}}/index.php?page=cart" }
        },
        {
          "name": "GET eliminar_carrito",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/index.php?page=eliminar_carrito&id={{id_variante}}"
          },
          "variable": [ { "key": "id_variante", "value": "1" } ]
        }
      ]
    },
    {
      "name": "Pago",
      "description": "Flujo de pago vía vista pago.php + PaymentController. Requiere login y carrito activo.",
      "item": [
        {
          "name": "GET pago (obtiene CSRF)",
          "request": { "method": "GET", "url": "{{baseUrl}}/index.php?page=pago" },
          "description": "Usa esta llamada para establecer sesión y capturar el token CSRF del formulario."
        },
        {
          "name": "POST pago (form)",
          "request": {
            "method": "POST",
            "header": [ { "key": "Content-Type", "value": "application/x-www-form-urlencoded" } ],
            "url": "{{baseUrl}}/index.php?page=pago",
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                { "key": "csrf_token", "value": "{{csrf_token}}", "type": "text" },
                { "key": "id_direccion", "value": "{{id_direccion}}", "type": "text" },
                { "key": "metodo_pago", "value": "tarjeta", "type": "text" }
              ]
            }
          },
          "variable": [
            { "key": "csrf_token", "value": "", "description": "Copiar desde GET pago (input hidden)." },
            { "key": "id_direccion", "value": "1", "description": "ID válido del usuario actual." }
          ],
          "description": "Procesa el pedido, limpia carrito y redirige a gracias."
        }
      ]
    },
    {
      "name": "Vendedor / Envios",
      "description": "Requiere login como Vendedor. Usa ?page=vendedor_envios (POST).",
      "item": [
        {
          "name": "POST registrar_envio",
          "request": {
            "method": "POST",
            "header": [ { "key": "Content-Type", "value": "application/x-www-form-urlencoded" } ],
            "url": "{{baseUrl}}/index.php?page=vendedor_envios",
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                { "key": "accion", "value": "registrar_envio", "type": "text" },
                { "key": "id_detalle_envio", "value": "{{id_detalle_envio}}", "type": "text" },
                { "key": "id_empresa_envio", "value": "{{id_empresa_envio}}", "type": "text" },
                { "key": "numero_seguimiento", "value": "TKY-0001-ABC", "type": "text" }
              ]
            }
          },
          "variable": [
            { "key": "id_detalle_envio", "value": "1" },
            { "key": "id_empresa_envio", "value": "1" }
          ]
        }
      ]
    },
    {
      "name": "Admin",
      "description": "Flujo básico de administración (login y vistas).",
      "item": [
        {
          "name": "POST admin_login",
          "request": {
            "method": "POST",
            "header": [ { "key": "Content-Type", "value": "application/x-www-form-urlencoded" } ],
            "url": "{{baseUrl}}/index.php?page=admin_procesar_login",
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                { "key": "usuario", "value": "admin", "type": "text" },
                { "key": "clave", "value": "admin123", "type": "text" }
              ]
            }
          }
        },
        {
          "name": "GET admin_pedidos",
          "request": { "method": "GET", "url": "{{baseUrl}}/index.php?page=admin_pedidos" }
        },
        {
          "name": "GET admin_ver_pedido",
          "request": { "method": "GET", "url": "{{baseUrl}}/index.php?page=admin_ver_pedido&id={{id_pedido}}" },
          "variable": [ { "key": "id_pedido", "value": "1" } ]
        }
      ]
    },
    {
      "name": "Mi Perfil",
      "description": "Acciones de perfil/direcciones/pagos del usuario autenticado.",
      "item": [
        {
          "name": "POST agregar_direccion",
          "request": {
            "method": "POST",
            "header": [ { "key": "Content-Type", "value": "application/x-www-form-urlencoded" } ],
            "url": "{{baseUrl}}/index.php?page=mi_perfil&seccion=direcciones",
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                { "key": "accion", "value": "agregar_direccion", "type": "text" },
                { "key": "direccion", "value": "Av. Demo 123", "type": "text" },
                { "key": "ciudad", "value": "Lima", "type": "text" },
                { "key": "pais", "value": "Peru", "type": "text" },
                { "key": "codigo_postal", "value": "1500", "type": "text" },
                { "key": "es_principal", "value": "1", "type": "text" }
              ]
            }
          }
        },
        {
          "name": "POST agregar_tarjeta",
          "request": {
            "method": "POST",
            "header": [ { "key": "Content-Type", "value": "application/x-www-form-urlencoded" } ],
            "url": "{{baseUrl}}/index.php?page=mi_perfil&seccion=pagos",
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                { "key": "accion", "value": "agregar_tarjeta", "type": "text" },
                { "key": "nombre_tarjeta", "value": "Cliente Demo", "type": "text" },
                { "key": "numero_tarjeta", "value": "4444444444444", "type": "text" },
                { "key": "expiracion", "value": "12/30", "type": "text" },
                { "key": "tipo_tarjeta", "value": "Visa", "type": "text" }
              ]
            }
          }
        }
      ]
    }
  ]
}
